<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>

	<div style="text-align:center">
		<video id="video" autoplay style="max-width:500px; width:100%;"></video><br>
		<button onclick="startVideo();">Start</button>
		<button onclick="stopVideo();">Stop</button>
	</div>    

    <script>
        var video = document.getElementById("video");
	var mediaRecorder;
	var recordedChunks = [];
        function startVideo(){
            if(navigator.mediaDevices === undefined){
                alert("Media devices is not supported at all");
            }else{
                navigator.mediaDevices.getUserMedia({audio:true, video:true }).then(function (stream){
                    	video.srcObject = stream;
			
			mediaRecorder = new MediaRecorder(stream, {mimeType: 'video/mp4'});
			mediaRecorder.start();
        		mediaRecorder.ondataavailable = function(event){
          		if (event.data.size > 0) {
            			recordedChunks.push(event.data);
          		} else {
            			alert("Something went Wrong");
          		}
        	};	
                }).catch(function (error) {
                    alert("Error: "+error);
                });
            }
        }
	    
        function stopVideo(){
            var stream = video.srcObject;
            video.srcObject = null;
            stream.getTracks().forEach(function(track) {
                track.stop();
            });
		
		mediaRecorder.onstop = function(){
      		var blob = new Blob(recordedChunks, {'type': 'video/webm;'});
  
      		var url = URL.createObjectURL(blob);
		var downloadVideo = document.createElement('a');
		downloadVideo.href = url;
      		downloadVideo.download = "video.webm";
		document.appendChild(downloadVideo);
      		downloadVideo.click();
      		window.URL.revokeObjectURL(url);
			 
		recordedChunks = [];
    	}

        }
    </script>
</body>
</html>
